<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.mallfe.item.mapper.TpMapper">


    <update id="updateStatusToCancel" parameterType="com.mallfe.item.pojo.Tp">
        update mf_tp set status = 9 where lsh = #{lsh} and status = 0
    </update>
    <update id="updateStatusToCommit">
        update mf_tp set status = 1 where lsh = #{lsh} and status = 0
    </update>
    <update id="updateTpmxToUnFinish">
        update mf_tp_mx set status = 2 where lsh = #{lsh} and status = 0
    </update>
    <update id="updateStatusToFinish">
        update mf_tp set status = 2 where lsh = #{lsh} and status = 1
    </update>
    <select id="selectTp" resultType="com.mallfe.item.pojo.Tp">
        select a.id,a.lsh,a.driver_code as driverCode,b.driver_name as driverName,
        a.path_code as pathCode,c.path_name as pathName ,a.lrsj,a.fcsj,a.status,
        a.lrid,a.lrusername,a.truename,a.dept_code as deptCode,a.store_code as storeCode,
        case a.status
        when 0 then '新增'
        when 1 then '已发出'
        when 2 then '已送达'
        when 9 then '已作废'
        end as statusInfo
        from mf_tp a left join mf_driver b on a.driver_code = b.driver_code
        left join mf_path c on a.path_code = c.path_code
        <where>
            <if test="lsh != null">
                a.lsh = #{lsh}
            </if>
            <if test="status != null">
                and a.status = #{status}
            </if>
        </where>
        order by a.lsh desc
    </select>

</mapper>
